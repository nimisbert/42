Version 4
SHEET 1 2228 1024
WIRE 992 96 448 96
WIRE 448 144 448 96
WIRE 448 144 240 144
WIRE 464 144 448 144
WIRE 864 144 544 144
WIRE 992 144 992 96
WIRE 768 208 688 208
WIRE 784 208 768 208
WIRE 864 208 864 144
WIRE 864 208 848 208
WIRE 688 224 688 208
WIRE 48 240 -16 240
WIRE 176 240 128 240
WIRE 320 240 176 240
WIRE 336 240 320 240
WIRE 448 240 448 144
WIRE 464 240 448 240
WIRE 592 240 544 240
WIRE 640 240 592 240
WIRE 992 240 992 224
WIRE 176 256 176 240
WIRE -16 288 -16 240
WIRE -16 288 -64 288
WIRE 16 288 -16 288
WIRE 640 288 624 288
WIRE 944 288 816 288
WIRE -64 304 -64 288
WIRE 16 304 16 288
WIRE 816 304 816 288
WIRE 768 320 768 208
WIRE 784 320 768 320
WIRE 240 336 240 144
WIRE 240 336 224 336
WIRE 256 336 240 336
WIRE 320 336 320 320
WIRE 432 336 320 336
WIRE 464 336 432 336
WIRE 688 336 688 304
WIRE 688 336 544 336
WIRE 864 336 864 208
WIRE 864 336 848 336
WIRE 992 336 992 320
WIRE 432 352 432 336
WIRE 688 352 688 336
WIRE 784 352 768 352
WIRE 624 368 624 288
WIRE 640 368 624 368
WIRE 816 384 816 368
WIRE -64 400 -64 384
WIRE -16 400 -64 400
WIRE 16 400 16 368
WIRE 16 400 -16 400
WIRE 320 400 320 336
WIRE 368 400 320 400
WIRE -640 416 -672 416
WIRE -560 416 -576 416
WIRE -480 416 -512 416
WIRE -384 416 -416 416
WIRE 592 416 592 240
WIRE 640 416 592 416
WIRE 688 448 688 432
WIRE 768 448 768 352
WIRE 768 448 688 448
WIRE -1008 464 -1120 464
WIRE -896 464 -1008 464
WIRE -672 464 -672 416
WIRE -672 464 -768 464
WIRE -560 464 -560 416
WIRE -512 464 -512 416
WIRE -512 464 -560 464
WIRE -384 464 -384 416
WIRE -352 464 -384 464
WIRE -240 464 -272 464
WIRE -128 464 -160 464
WIRE 176 464 176 352
WIRE 176 464 -128 464
WIRE 624 464 624 368
WIRE 624 464 224 464
WIRE 944 464 944 288
WIRE 944 464 624 464
WIRE 432 480 432 448
WIRE 432 480 320 480
WIRE 432 496 432 480
WIRE -1008 512 -1008 464
WIRE -896 512 -896 464
WIRE -768 512 -768 464
WIRE -672 512 -672 464
WIRE -656 512 -672 512
WIRE -560 512 -560 464
WIRE -560 512 -576 512
WIRE -512 512 -512 464
WIRE -496 512 -512 512
WIRE -384 512 -384 464
WIRE -384 512 -416 512
WIRE -128 512 -128 464
WIRE -1120 528 -1120 464
WIRE 320 544 320 480
WIRE 368 544 320 544
WIRE 432 608 432 592
WIRE 432 608 160 608
WIRE 224 624 224 464
WIRE -16 640 -16 400
WIRE 48 640 -16 640
WIRE 160 640 160 608
WIRE 160 640 128 640
WIRE 192 640 160 640
WIRE 592 640 592 416
WIRE 768 640 768 448
WIRE 944 640 944 464
WIRE -1120 656 -1120 592
WIRE -1008 656 -1008 592
WIRE -1008 656 -1120 656
WIRE -896 656 -896 592
WIRE -896 656 -1008 656
WIRE -768 656 -768 592
WIRE -768 656 -896 656
WIRE -528 656 -768 656
WIRE -128 656 -128 592
WIRE -128 656 -448 656
WIRE 320 656 320 544
WIRE 320 656 256 656
WIRE 192 672 160 672
WIRE -768 688 -768 656
WIRE -16 720 -16 640
WIRE 48 720 -16 720
WIRE 160 720 160 672
WIRE 160 720 128 720
WIRE 224 720 224 688
WIRE 224 720 160 720
WIRE 224 736 224 720
WIRE 592 736 592 720
WIRE 768 736 768 704
WIRE 944 736 944 720
FLAG 224 736 0
FLAG 592 736 0
FLAG 816 384 0
FLAG 768 736 0
FLAG 944 736 0
FLAG 992 336 0
FLAG 336 240 out
FLAG 256 336 gate
FLAG 768 208 in-
FLAG 768 448 in+
FLAG 864 208 ctrl
FLAG 320 400 pwr
FLAG -768 688 0
FLAG -896 464 soc
FLAG -768 464 batt
FLAG -128 464 load
SYMBOL Diode 0 304 R0
SYMATTR InstName D1
SYMATTR Value pvpanel
SYMBOL Res 144 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value .5
SYMBOL Res 144 704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value .1
SYMBOL OpAmps/LT1013 224 592 R0
SYMATTR InstName U1
SYMBOL Res 144 624 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 20
SYMBOL npn 368 496 R0
SYMATTR InstName Q1
SYMATTR Value 2N2222
SYMBOL npn 368 352 R0
SYMATTR InstName Q2
SYMATTR Value 2N2222
SYMBOL Res 304 224 R0
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL Res 560 320 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL Res 560 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 500k
SYMBOL Res 560 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL sw 688 208 R0
SYMATTR InstName S1
SYMATTR Value MSW
SYMBOL sw 688 336 R0
SYMATTR InstName S2
SYMATTR Value MSW
SYMBOL OpAmps/LT1013 816 272 R0
SYMATTR InstName U2
SYMBOL voltage 592 624 R0
WINDOW 3 -173 166 Left 2
SYMATTR Value PULSE(20 0 0 .1u .1u 20m 40m)
SYMATTR InstName V1
SYMBOL Cap 752 640 R0
SYMATTR InstName C1
SYMATTR Value .3µ
SYMBOL Cap 848 192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value .3µ
SYMBOL voltage 944 624 R0
SYMATTR InstName V2
SYMATTR Value 12
SYMBOL Res 976 128 R0
SYMATTR InstName R9
SYMATTR Value 10Meg
SYMBOL voltage 992 224 R0
SYMATTR InstName V3
SYMATTR Value 8
SYMBOL nmos 224 256 M0
SYMATTR InstName M1
SYMATTR Value FDB2532
SYMBOL Cap -1136 528 R0
SYMATTR InstName C4
SYMATTR Value 18000
SYMBOL Res -1024 496 R0
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL bi -896 512 R0
SYMATTR InstName B1
SYMATTR Value I=I(R13)
SYMBOL bv -768 496 R0
WINDOW 3 -346 293 Left 2
SYMATTR Value V=3.3*(-8.0128*pwr(V(soc),5) + 22.509*pwr(V(soc),4) - 19.929*pwr(V(soc),3) + 4.332*pwr(V(soc),2) + 2.0965*V(soc) + 0.0026)
SYMATTR InstName B2
SYMBOL Cap -576 400 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 1000p
SYMBOL Cap -416 400 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 10µ
SYMBOL Res -512 528 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R10
SYMATTR Value .1
SYMBOL Res -672 528 R270
WINDOW 0 37 59 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R11
SYMATTR Value .1
SYMBOL Res -368 480 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R12
SYMATTR Value .1
SYMBOL Ind -256 480 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 1n
SYMBOL Res -432 640 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 1m
SYMBOL Res -144 496 R0
SYMATTR InstName RLoad
SYMATTR Value 10k
SYMBOL bi -64 384 R180
WINDOW 0 26 109 Left 2
WINDOW 3 23 83 Left 2
SYMATTR InstName B3
SYMATTR Value I = 0.66
TEXT -1104 920 Left 2 !.model MSW SW(Ron=1 Roff=100Meg Vt=0 Vh=0 Lser=10n Vser=0)
TEXT -1104 944 Left 2 !.model pvpanel D(Is=10n Rs=.5 N=8 Cjo=10n M=.5 Eg=8 Xti=40 BV=5 IBV=.001 Vj=.4 Iave=1 Vpk=5 mfg=Generic type=PV)
TEXT -1104 968 Left 2 !.model 2N2222 NPN(IS=1E-14 VAF=100 BF=200 IKF=0.3 XTB=1.5 BR=3 CJC=8E-12 CJE=25E-12 TR=100E-9 TF=400E-12 ITF=1 VTF=2 XTF=3 RB=10 RC=.3 RE=.2 Vceo=30 Icrating=800m mfg=Philips)
TEXT -1104 896 Left 2 !.include FDB2532.mod
TEXT -1104 872 Left 2 !.tran 0 72 1
TEXT -1104 848 Left 2 !.ic V(soc)=1
